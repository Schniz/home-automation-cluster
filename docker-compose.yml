# Generated by generate.ts
version: '3'
networks:
  caddy:
    external: true
services:
  watchtower:
    restart: unless-stopped
    image: containrrr/watchtower
    container_name: watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /media/SchlezExt2/configs/watchtower:/config
    command:
      - '--cleanup'
      - '--notification-url'
      - /config/notification_url
  gitea:
    restart: unless-stopped
    image: gitea/gitea
    container_name: gitea
    networks:
      - caddy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/library/git/gitea/conf:/etc/gitea
      - /media/SchlezExt2/library/git/:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.1_@git: host git.home.hagever.com
      caddy_0.1_handle: '@git'
      caddy_1: http://git
      caddy_1.redir: https://git.home.hagever.com{uri}
      caddy_0.1_handle.reverse_proxy: '{{upstreams 3000}}'
    ports:
      - '2222:2222'
  caddy:
    restart: unless-stopped
    image: ghcr.io/schniz/home-automation-cluster-caddy:main
    env_file: ./caddy/environment
    environment:
      CADDY_INGRESS_NETWORKS: caddy
    container_name: caddy
    networks:
      - caddy
    volumes:
      - /media/SchlezExt2/configs/caddy/data/:/data/caddy/
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - published: 443
        target: 443
      - published: 80
        target: 80
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.2_@caddy: host caddy.home.hagever.com
      caddy_0.2_handle: '@caddy'
      caddy_2: http://caddy
      caddy_2.redir: https://caddy.home.hagever.com{uri}
      caddy_0.2_handle.request_header: Host "localhost:2019"
      caddy_0.2_handle.reverse_proxy: http://localhost:2019
      caddy_0.3_@ha: host ha.home.hagever.com
      caddy_0.3_handle: '@ha'
      caddy_3: http://ha
      caddy_3.redir: https://ha.home.hagever.com{uri}
      caddy_0.3_handle.reverse_proxy: http://192.168.31.38:8123
      caddy_0.4_@media: host media.home.hagever.com
      caddy_0.4_handle: '@media'
      caddy_4: http://media
      caddy_4.redir: https://media.home.hagever.com{uri}
      caddy_0.4_handle.reverse_proxy: http://192.168.31.38:8096
      caddy_0.5_@esphome: host esphome.home.hagever.com
      caddy_0.5_handle: '@esphome'
      caddy_5: http://esphome
      caddy_5.redir: https://esphome.home.hagever.com{uri}
      caddy_0.5_handle.reverse_proxy: http://192.168.31.38:6052
      caddy_0.6_@upsnap: host upsnap.home.hagever.com
      caddy_0.6_handle: '@upsnap'
      caddy_6: http://upsnap
      caddy_6.redir: https://upsnap.home.hagever.com{uri}
      caddy_0.6_handle.reverse_proxy: http://192.168.31.38:8090
      caddy_0.7_@dns: host dns.home.hagever.com
      caddy_0.7_handle: '@dns'
      caddy_7: http://dns
      caddy_7.redir: https://dns.home.hagever.com{uri}
      caddy_0.7_handle.reverse_proxy: http://192.168.31.38:8881
      caddy_0.7_handle.redir: / /admin
  transmission:
    restart: unless-stopped
    container_name: transmission
    image: linuxserver/transmission
    networks:
      - caddy
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.8_@torrent: host torrent.home.hagever.com
      caddy_0.8_handle: '@torrent'
      caddy_8: http://torrent
      caddy_8.redir: https://torrent.home.hagever.com{uri}
      caddy_0.8_handle.reverse_proxy: '{{upstreams 9091}}'
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/library/downloads:/downloads
      - /media/SchlezExt2/configs/transmission:/config
  jackett:
    restart: unless-stopped
    networks:
      - caddy
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.9_@jackett: host jackett.home.hagever.com
      caddy_0.9_handle: '@jackett'
      caddy_9: http://jackett
      caddy_9.redir: https://jackett.home.hagever.com{uri}
      caddy_0.9_handle.reverse_proxy: '{{upstreams 9117}}'
    image: linuxserver/jackett:latest
    container_name: jackett
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/jackett:/config
  sonarr:
    restart: unless-stopped
    image: linuxserver/sonarr:latest
    container_name: sonarr
    networks:
      - caddy
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.10_@sonarr: host sonarr.home.hagever.com
      caddy_0.10_handle: '@sonarr'
      caddy_10: http://sonarr
      caddy_10.redir: https://sonarr.home.hagever.com{uri}
      caddy_0.10_handle.reverse_proxy: '{{upstreams 8989}}'
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/sonarr:/config
      - /media/SchlezExt2/library/tv:/tv
      - /media/SchlezExt2/library:/library_root
      - /media/SchlezExt2/library/downloads:/downloads
  radarr:
    restart: unless-stopped
    image: linuxserver/radarr:latest
    container_name: radarr
    networks:
      - caddy
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.11_@radarr: host radarr.home.hagever.com
      caddy_0.11_handle: '@radarr'
      caddy_11: http://radarr
      caddy_11.redir: https://radarr.home.hagever.com{uri}
      caddy_0.11_handle.reverse_proxy: '{{upstreams 7878}}'
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/radarr:/config
      - /media/SchlezExt2/library/movies:/movies
      - /media/SchlezExt2/library:/library_root
      - /media/SchlezExt2/library/downloads:/downloads
  bazarr:
    restart: unless-stopped
    image: linuxserver/bazarr:latest
    container_name: bazarr
    networks:
      - caddy
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.12_@bazarr: host bazarr.home.hagever.com
      caddy_0.12_handle: '@bazarr'
      caddy_12: http://bazarr
      caddy_12.redir: https://bazarr.home.hagever.com{uri}
      caddy_0.12_handle.reverse_proxy: '{{upstreams 6767}}'
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/bazarr:/config
      - /media/SchlezExt2/library/movies:/movies
      - /media/SchlezExt2/library/tv:/tv
      - /media/SchlezExt2/library:/library_root
  jellyfin:
    restart: unless-stopped
    image: linuxserver/jellyfin
    container_name: jellyfin
    network_mode: host
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/jellyfin:/config
      - /media/SchlezExt2/library/tv:/data/tvshows
      - /media/SchlezExt2/library/movies:/data/movies
      - /media/SchlezExt2/library:/library_root
      - type: tmpfs
        target: /tmp-transcoding
  ical_http_sensor:
    restart: unless-stopped
    image: ghcr.io/schniz/ical_http_server:main
    container_name: ical-http-sensor
    environment:
      - TZ=Asia/Jerusalem
    networks:
      - caddy
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.13_@icalsensor: host ical-sensor.home.hagever.com
      caddy_0.13_handle: '@icalsensor'
      caddy_13: http://icalsensor
      caddy_13.redir: https://ical-sensor.home.hagever.com{uri}
      caddy_0.13_handle.reverse_proxy: '{{upstreams 8080}}'
  tailscale:
    restart: unless-stopped
    image: tailscale/tailscale
    privileged: true
    container_name: tailscale
    hostname: homelab.vpn.hagever.com
    network_mode: host
    env_file: ./tailscale/environment
    environment:
      - TZ=Asia/Jerusalem
    volumes:
      - /var/lib:/var/lib
      - /dev/net/tun:/dev/net/tun
  filebrowser:
    restart: unless-stopped
    image: filebrowser/filebrowser:s6
    container_name: filebrowser
    networks:
      - caddy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/filebrowser/settings:/config
      - /media/SchlezExt2/configs/filebrowser/db:/database
      - /media/SchlezExt2/library/downloads:/downloads
      - /media/SchlezExt2:/srv
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.14_@files: host files.home.hagever.com
      caddy_0.14_handle: '@files'
      caddy_14: http://files
      caddy_14.redir: https://files.home.hagever.com{uri}
      caddy_0.14_handle.reverse_proxy: '{{upstreams 80}}'
  mosquitto:
    restart: unless-stopped
    image: eclipse-mosquitto:latest
    container_name: mosquitto
    networks:
      - caddy
    environment:
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/configs/mosquitto:/mosquitto
    ports:
      - published: 1883
        target: 1883
  homeassistant:
    restart: unless-stopped
    container_name: homeassistant
    image: ghcr.io/home-assistant/home-assistant:stable
    environment:
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/homeassistant-config:/config
      - /etc/localtime:/etc/localtime:ro
      - /run/dbus:/run/dbus:ro
      - /media/SchlezExt2/library:/library
    privileged: true
    network_mode: host
  esphome:
    restart: unless-stopped
    container_name: esphome
    image: ghcr.io/esphome/esphome
    volumes:
      - /media/SchlezExt2/configs/esphome:/config
      - /etc/localtime:/etc/localtime:ro
    environment:
      - TZ=Asia/Jerusalem
      - ESPHOME_DASHBOARD_USE_PING=true
      - ESPHOME_DASHBOARD_RELATIVE_URL=/
      - ESPHOME_QUICKWIZARD=
      - ESPHOME_IS_HA_ADDON=
      - DISABLE_HA_AUTHENTICATION=
    network_mode: host
    privileged: true
    env_file: ./esphome/environment
  pihole:
    restart: unless-stopped
    container_name: pihole
    image: pihole/pihole:latest
    ports:
      - 53:53/tcp
      - 53:53/udp
      - 67:67/udp
      - 8881:80/tcp
    environment:
      - TZ=Asia/Jerusalem
    env_file: ./pihole/environment
    volumes:
      - /media/SchlezExt2/configs/pihole/etc-pihole:/etc/pihole
      - /media/SchlezExt2/configs/pihole/etc-dnsmasq.d:/etc/dnsmasq.d
    cap_add:
      - NET_ADMIN
  upsnap:
    restart: unless-stopped
    image: ghcr.io/seriousm4x/upsnap:4
    environment:
      - TZ=Asia/Jerusalem
      - PUID=1000
      - PGID=1000
      - UPSNAP_SCAN_RANGE=192.168.31.0/24
      - UPSNAP_PING_PRIVILEGED=true
    network_mode: host
    healthcheck:
      test: curl -fs http://localhost:8090/api/health || exit 1
    volumes:
      - /media/SchlezExt2/configs/upsnap/data:/data
  audiobookshelf:
    restart: unless-stopped
    image: ghcr.io/advplyr/audiobookshelf:latest
    container_name: audiobookshelf
    networks:
      - caddy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
    volumes:
      - /media/SchlezExt2/library/audiobooks:/audiobooks
      - /media/SchlezExt2/library/podcasts:/podcasts
      - /media/SchlezExt2/configs/audiobookshelf:/config
      - /media/SchlezExt2/configs/audiobookshelf/metadata:/metadata
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.15_@audiobooks: host audiobooks.home.hagever.com
      caddy_0.15_handle: '@audiobooks'
      caddy_15: http://audiobooks
      caddy_15.redir: https://audiobooks.home.hagever.com{uri}
      caddy_0.15_handle.reverse_proxy: '{{upstreams 80}}'
  opencode:
    restart: unless-stopped
    image: ghcr.io/schniz/opencode-web-bun:main
    container_name: opencode-web
    networks:
      - caddy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Jerusalem
      - PORT=3000
      - OPENCODE_WEB_REPOS_PATH=/repos
      - OPENCODE_WEB_GH_SETUP_GIT=1
    volumes:
      - >-
        /media/SchlezExt2/configs/opencode-web/auth.json:/root/.local/share/opencode/auth.json
      - /media/SchlezExt2/configs/opencode-web/gh:/root/.config/gh
      - /media/SchlezExt2/library/opencode/repos:/repos
      - >-
        /media/SchlezExt2/library/opencode/share:/root/.local/share/opencode/project
    labels:
      caddy_0: '*.home.hagever.com'
      caddy_0.tls.dns: cloudflare {env.CF_API_TOKEN}
      caddy_0.16_@opencode: host opencode.home.hagever.com
      caddy_0.16_handle: '@opencode'
      caddy_16: http://opencode
      caddy_16.redir: https://opencode.home.hagever.com{uri}
      caddy_0.16_handle.reverse_proxy: '{{upstreams 3000}}'

